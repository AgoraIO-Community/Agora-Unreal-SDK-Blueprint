<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Agora Unreal Engine C++ Plugin: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="agoralightblue.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Agora Unreal Engine C++ Plugin
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Use this guide to quickly start a basic voice/video call with the Agora SDK Plugin for Unreal Engine on Windows and MacOS.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
Try the demo</h2>
<p>We provide an open-source #TODO:link demo project that implements the basic one-to-one video call on GitHub. You can try the demo and view the source code.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Prerequisites</h2>
<ul>
<li>Unreal Engine 4.23 or later</li>
<li>Microsoft Visual Studio or Xcode( version required by Unreal Engine )</li>
<li>A Windows device running Windows 7 or later or Mac device</li>
<li>A valid Agora account. (<a href="https://dashboard.agora.io/?_ga=2.169392609.1139696370.1573117530-1815680581.1567671681" target="_blank">Sign up</a> for free)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
Open the specified ports in Firewall Requirements if your network has a firewall.</h3>
<p><a href="https://docs.agora.io/cn/Agora%20Platform/firewall?platform=All%20Platforms" target="_blank">Firewall Requirements</a></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Set up the development environment</h2>
<p>In this section, we will create an Unreal Engine project and integrate the plugin into the project.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Create a project</h2>
<p>Now, let's build a project from scratch. Skip to <b>Installation</b> if a project already exists.</p>
<ol type="1">
<li>Open <b>Unreal Engine Editor</b> and click <b>New project</b>.</li>
<li>On the <b>New Project</b> panel, choose C++ as the project type, input the project name, choose the project location, and click <b>Create Project</b>.</li>
</ol>
<h2><a class="anchor" id="autotoc_md5"></a>
Installation</h2>
<p>Follow these steps to integrate the Agora Plugin into your project.</p>
<ol type="1">
<li>Copy the plugin to [your_project]/Plugins</li>
<li>Add plugin dependency into .Build.cs, Private Dependencies section <code>PrivateDependencyModuleNames.AddRange(new string[] { "AgoraPlugin" });</code></li>
<li>Restart <b>Unreal Engine</b> (if it is running)</li>
<li>Find the plugin under the **#TODO:category** category and enable it.</li>
</ol>
<h2><a class="anchor" id="autotoc_md6"></a>
Implement the basic call</h2>
<ol type="1">
<li>Create the UI</li>
</ol>
<p>Create the user interface (UI) for the one-to-one call in your project. Skip to <b>Initialize AgoraRtcEngine</b> if you already have a UI in your project.</p>
<p>For a video call, we recommend adding the following elements into the UI:</p>
<ul>
<li>The local video view</li>
<li>The remote video view</li>
<li>The end-call button</li>
</ul>
<p>When you use the UI setting of the demo project, you can see the following interface:</p>
<p><img src="HowTo/ExampleUI.png" alt="Example UI" class="inline"/></p>
<ol type="1">
<li>Initialize AgoraRtcEngine</li>
</ol>
<p>Create and initialize the AgoraRtcEngine object before calling any other Agora APIs.</p>
<p>In this step, you need to use the App ID of your project. Follow these steps to create an Agora project in Dashboard and get an App ID.</p>
<ol type="1">
<li>Go to <a href="https://dashboard.agora.io/?_ga=2.266490958.1139696370.1573117530-1815680581.1567671681" target="_blank">Dashboard</a> and click the <b>Project Management</b> icon on the left navigation panel.</li>
<li>Click <b>Create</b> and follow the on-screen instructions to set the project name, choose an authentication mechanism, and click <b>Submit</b>.</li>
<li>On the <b>Project Management page</b>, find the <b>App ID</b> of your project.</li>
</ol>
<p>Call the <code>createAgoraRtcEngine</code> method and the <code>initialize</code> method, and pass in the App ID to initialize the AgoraRtcEngine object.</p>
<div class="fragment"><div class="line">RtcEnginePtr = TSharedPtr&lt;agora::rtc::ue4::AgoraRtcEngine&gt;(<a class="code" href="classagora_1_1rtc_1_1ue4_1_1_agora_rtc_engine.html#a4f125aa58967798efa5f8ee8817b4897">agora::rtc::ue4::AgoraRtcEngine::createAgoraRtcEngine</a>());</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> agora::rtc::RtcEngineContext ctx;</div>
<div class="line">ctx.appId = <span class="stringliteral">&quot;aab8b8f5a8cd4469a63042fcfafe7063&quot;</span>;</div>
<div class="line">ctx.eventHandler = <span class="keyword">new</span> RtcEngineEventHandler();</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> nRet = RtcEnginePtr-&gt;initialize(ctx);</div>
</div><!-- fragment --><ol type="1">
<li>Set the local video view and the remote video view</li>
</ol>
<p>If you are implementing a voice call, skip to <b>Join a channel</b>. After initializing the AgoraRtcEngine object, set the local video view before joining the channel so that you can see yourself in the call. Follow these steps to configure the video view:</p>
<ul>
<li>Call the <code>enableVideo</code> method to enable the video module.</li>
<li><p class="startli">You need to implement the IVideoFrameObserver class, register the following callbacks according to your scenarios:</p>
<p class="startli">-<code>onCaptureVideoFrame</code>: Occurs each time the SDK receives a video frame captured by the local camera.</p>
<p class="startli">-<code>onRenderVideoFrame</code>: Occurs each time the SDK receives a video frame sent by the remote user.</p>
</li>
<li>Create AgoraMediaEngine object and use <code>registerVideoFrameObserver</code> method to register your IVideoFrameObserver implementation.</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">class </span>AGORAVIDEOCALL_API VideoFrameObserver : <span class="keyword">public</span> agora::media::IVideoFrameObserver</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   <span class="keyword">virtual</span> ~VideoFrameObserver();</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   <span class="keywordtype">bool</span> onCaptureVideoFrame(VideoFrame&amp; videoFrame) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordtype">bool</span> onRenderVideoFrame(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uid, VideoFrame&amp; videoFrame) <span class="keyword">override</span>;</div>
<div class="line">};</div>
</div><!-- fragment --><div class="fragment"><div class="line">TSharedPtr&lt;agora::media::ue4::AgoraMediaEngine&gt; MediaEnginePtr </div>
<div class="line">   = TSharedPtr&lt;agora::media::ue4::AgoraMediaEngine&gt;(<a class="code" href="classagora_1_1media_1_1ue4_1_1_agora_media_engine.html#adc39e213c0950b0362d0bb80fe00068e">agora::media::ue4::AgoraMediaEngine::Create</a>(RtcEnginePtr.Get()));</div>
<div class="line">TUniquePtr&lt;VideoFrameObserver&gt; VideoFrameObserverPtr = MakeUnique&lt;VideoFrameObserver&gt;();</div>
<div class="line">MediaEnginePtr-&gt;registerVideoFrameObserver(VideoFrameObserverPtr.Get());</div>
</div><!-- fragment --><ol type="1">
<li>Render video frames</li>
</ol>
<p>IVideoFrameObserver callbacks return VideoFrame that data format is YUV420. First you need to to convert it to ARGB:</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> VideoFrameObserver::onCaptureVideoFrame(VideoFrame&amp; Frame)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">auto</span> BufferSize = <a class="code" href="classagora_1_1media_1_1ue4_1_1_agora_video_frame_converter.html#a165900abbc65d479fb1264f890b85e87">agora::media::ue4::AgoraVideoFrameConverter::getOutBufferSize</a>(</div>
<div class="line">      Frame.width,</div>
<div class="line">      Frame.height);</div>
<div class="line">   uint8_t* CaptureBuffer = <span class="keyword">new</span> uint8_t[BufferSize];</div>
<div class="line">   </div>
<div class="line">   uint8_t* SrcY = static_cast&lt;uint8_t*&gt;(Frame.yBuffer);</div>
<div class="line">   uint8_t* SrcU = static_cast&lt;uint8_t*&gt;(Frame.uBuffer);</div>
<div class="line">   uint8_t* SrcV = static_cast&lt;uint8_t*&gt;(Frame.vBuffer);</div>
<div class="line">   <a class="code" href="classagora_1_1media_1_1ue4_1_1_agora_video_frame_converter.html#a82fe32fd0f1bfae218b76763735142f3">agora::media::ue4::AgoraVideoFrameConverter::convertVideoFrameToARGB</a>(</div>
<div class="line">      SrcY, SrcU, SrcV, Frame.yStride, Frame.uStride, Frame.vStride, Frame.width, Frame.height, CaptureBuffer);</div>
<div class="line">      </div>
<div class="line">   <span class="comment">//Process CaptureBuffer</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Then render like this:</p>
<div class="fragment"><div class="line"><span class="comment">//.h file</span></div>
<div class="line">UPROPERTY(BlueprintReadOnly, meta = (BindWidget))</div>
<div class="line">   UImage* RenderTargetImage = <span class="keyword">nullptr</span>;</div>
<div class="line">UPROPERTY(EditDefaultsOnly)</div>
<div class="line">   UTexture2D* RenderTargetTexture = <span class="keyword">nullptr</span>;</div>
<div class="line">uint8* Buffer = <span class="keyword">nullptr</span>;</div>
<div class="line">uint32_t Width = 0;</div>
<div class="line">uint32_t Height = 0;</div>
<div class="line">FUpdateTextureRegion2D* UpdateTextureRegion = <span class="keyword">nullptr</span>;</div>
<div class="line">FSlateBrush Brush;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//.cpp file</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> UpdateTextureRegion = <span class="keyword">new</span> FUpdateTextureRegion2D(0, 0, 0, 0, Width, Height);</div>
<div class="line"><span class="keyword">auto</span> RenderTargetTexture = UTexture2D::CreateTransient(Width, Height);</div>
<div class="line">RenderTargetTexture-&gt;UpdateResource();</div>
<div class="line">RenderTargetTexture-&gt;UpdateTextureRegions(0, 1, UpdateTextureRegion, Width * 4, (uint32)4, Buffer);</div>
<div class="line">Brush.SetResourceObject(RenderTargetTexture);</div>
<div class="line">RenderTargetImage-&gt;SetBrush(Brush);</div>
</div><!-- fragment --><ol type="1">
<li>Join a channel</li>
</ol>
<p>After initializing the AgoraRtcEngine object and setting the local video view (for a video call), you can call the joinChannel method to join a channel. In this method, set the following parameters:</p>
<ul>
<li><code>channelName</code>: Specify the channel name that you want to join.</li>
<li>token: Pass a token that identifies the role and privilege of the user. You can set it as one of the following values:<ul>
<li>NULL.</li>
<li>A temporary token generated in Dashboard. A temporary token is valid for 24 hours. For details, see <a href="https://docs.agora.io/en/Agora%20Platform/token?platform=All%20Platforms#get-a-temporary-token" target="_blank">Get a Temporary Token</a> .</li>
<li>A token generated at the server. This applies to scenarios with high-security requirements. For details, see <a href="https://docs.agora.io/en/Video/token_server" target="_blank">Generate a token from Your Server</a>. <blockquote class="doxtable">
<p>If your project has enabled the app certificate, ensure that you provide a token. </p>
</blockquote>
</li>
</ul>
</li>
<li>uid: ID of the local user that is an integer and should be unique. If you set uid as 0, the SDK assigns a user ID for the local user and returns it in the <code>onJoinChannelSuccess</code> callback.</li>
</ul>
<div class="fragment"><div class="line">RtcEnginePtr-&gt;setEncryptionMode(<span class="stringliteral">&quot;aes-256-xts&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (!EncryptionToken.IsEmpty())</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> nRet = RtcEnginePtr-&gt;setEncryptionSecret(TCHAR_TO_ANSI(*EncryptionToken));</div>
<div class="line">   <span class="keywordflow">if</span> (nRet &lt; 0)</div>
<div class="line">   {</div>
<div class="line">      <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">   }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> nRet = RtcEnginePtr-&gt;setChannelProfile(agora::rtc::CHANNEL_PROFILE_COMMUNICATION);</div>
<div class="line"><span class="keywordflow">if</span> (nRet &lt; 0)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
<div class="line">std::uint32_t nUID = 0;</div>
<div class="line">nRet = RtcEnginePtr-&gt;joinChannel(NULL, TCHAR_TO_ANSI(*ChannelName), NULL, nUID);</div>
<div class="line"><span class="keywordflow">if</span> (nRet &lt; 0)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><ol type="1">
<li>Leave the channel</li>
</ol>
<p>Call the <code>leaveChannel</code> method to leave the current call according to your scenario, for example, when the call ends, when you need to close the app, or when your app runs in the background.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Run the project in Unreal Editor</h2>
<p>Run the project on your Windows or Mac device. You can see both the local and remote video views when you successfully start a one-to-one video call in your app.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Package the project</h2>
<p>To package the project, in <b>Unreal Editor</b>, go to the <b>File-&gt;Package Project-&gt;Windows-&gt;Windows(64-bit)</b> or <b>Mac</b>, then select a folder where you want to package and wait for result.</p>
<p>Now need to package the plugin:</p>
<p><b>Edit-&gt;Plugins-&gt;</b> Skip Built-In plugins and scroll down to <b>Project</b>, click on <b>Other( #TODO:category? )</b> to find <b>AgoraPlugin</b>, then <b>Package</b>, and select the folder inside the packaged project.</p>
<p>Now you can ran the application from: [packaged_project_dir]/WindowsNoEditor/[your_project.exe or .app]</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Mac permissions</h2>
<p>Add the following permissions in the info.plist file for device access according to your needs:</p>
<p>Privacy - Camera Usage Description</p>
<p>Privacy - Microphone Usage Description</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Documentation</h2>
<p>Open the Doc/html/index.html file to view plugin documentation </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclassagora_1_1rtc_1_1ue4_1_1_agora_rtc_engine_html_a4f125aa58967798efa5f8ee8817b4897"><div class="ttname"><a href="classagora_1_1rtc_1_1ue4_1_1_agora_rtc_engine.html#a4f125aa58967798efa5f8ee8817b4897">agora::rtc::ue4::AgoraRtcEngine::createAgoraRtcEngine</a></div><div class="ttdeci">static AgoraRtcEngine * createAgoraRtcEngine()</div><div class="ttdoc">Creates the IRtcEngine object and returns the pointer.</div></div>
<div class="ttc" id="aclassagora_1_1media_1_1ue4_1_1_agora_video_frame_converter_html_a165900abbc65d479fb1264f890b85e87"><div class="ttname"><a href="classagora_1_1media_1_1ue4_1_1_agora_video_frame_converter.html#a165900abbc65d479fb1264f890b85e87">agora::media::ue4::AgoraVideoFrameConverter::getOutBufferSize</a></div><div class="ttdeci">static uint32_t getOutBufferSize(uint32_t width, uint32_t height)</div><div class="ttdoc">Retrieves buffer size for frame.</div></div>
<div class="ttc" id="aclassagora_1_1media_1_1ue4_1_1_agora_video_frame_converter_html_a82fe32fd0f1bfae218b76763735142f3"><div class="ttname"><a href="classagora_1_1media_1_1ue4_1_1_agora_video_frame_converter.html#a82fe32fd0f1bfae218b76763735142f3">agora::media::ue4::AgoraVideoFrameConverter::convertVideoFrameToARGB</a></div><div class="ttdeci">static int convertVideoFrameToARGB(uint8_t *srcY, uint8_t *srcU, uint8_t *srcV, uint32_t yStride, uint32_t uStride, uint32_t vStride, uint32_t width, uint32_t height, uint8_t *buffer)</div><div class="ttdoc">Converts a video frame to ARGB format.</div></div>
<div class="ttc" id="aclassagora_1_1media_1_1ue4_1_1_agora_media_engine_html_adc39e213c0950b0362d0bb80fe00068e"><div class="ttname"><a href="classagora_1_1media_1_1ue4_1_1_agora_media_engine.html#adc39e213c0950b0362d0bb80fe00068e">agora::media::ue4::AgoraMediaEngine::Create</a></div><div class="ttdeci">static AgoraMediaEngine * Create(agora::rtc::ue4::AgoraRtcEngine *RtcEngine)</div><div class="ttdoc">Creates the MediaEngine object.</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
